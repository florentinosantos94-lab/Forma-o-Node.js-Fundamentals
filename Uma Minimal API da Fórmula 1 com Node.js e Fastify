// Importação de módulos e configuração do servidor
const fastify = require('fastify')();

// Dados iniciais para simular um banco de dados simples
let livros = [
    { id: 1, titulo: 'O Senhor dos Anéis', autor: 'J.R.R. Tolkien' },
    { id: 2, titulo: 'Harry Potter e a Pedra Filosofal', autor: 'J.K. Rowling' }
];

// Rota para obter todos os livros
fastify.get('/livros', async (request, reply) => {
    return livros;
});

// Rota para obter um livro específico por ID
fastify.get('/livros/:id', async (request, reply) => {
    const livro = livros.find(l => l.id === parseInt(request.params.id));
    if (!livro) {
        reply.code(404).send({ error: 'Livro não encontrado' });
    }
    return livro;
});

// Rota para adicionar um novo livro
fastify.post('/livros', async (request, reply) => {
    const { titulo, autor } = request.body;
    const novoLivro = { id: livros.length + 1, titulo, autor };
    livros.push(novoLivro);
    return novoLivro;
});

// Rota para atualizar um livro existente
fastify.put('/livros/:id', async (request, reply) => {
    const { titulo, autor } = request.body;
    const livroIndex = livros.findIndex(l => l.id === parseInt(request.params.id));
    if (livroIndex !== -1) {
        livros[livroIndex] = { ...livros[livroIndex], titulo, autor };
        return livros[livroIndex];
    }
    reply.code(404).send({ error: 'Livro não encontrado' });
});

// Rota para deletar um livro existente
fastify.delete('/livros/:id', async (request, reply) => {
    const livroIndex = livros.findIndex(l => l.id === parseInt(request.params.id));
    if (livroIndex !== -1) {
        const livroDeletado = livros[livroIndex];
        livros = livros.filter(l => l.id !== parseInt(request.params.id));
        return livroDeletado;
    }
    reply.code(404).send({ error: 'Livro não encontrado' });
});

// Inicialização do servidor
const start = async () => {
    try {
        await fastify.listen(3000);
        console.log('Servidor rodando em http://localhost:3000');
    } catch (err) {
        console.error(err);
        process.exit(1);
    }
};

start();
